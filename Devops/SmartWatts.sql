DROP TABLE USERS_ROLES CASCADE CONSTRAINTS;

DROP TABLE TB_POST CASCADE CONSTRAINTS;
DROP TABLE TB_FATURA CASCADE CONSTRAINTS;
DROP TABLE TB_MORADOR CASCADE CONSTRAINTS;

DROP TABLE TB_RESIDENCIA CASCADE CONSTRAINTS;
DROP TABLE TB_ENDERECO CASCADE CONSTRAINTS;

DROP TABLE USUARIO CASCADE CONSTRAINTS;
DROP TABLE ROLE CASCADE CONSTRAINTS;
DROP TABLE TB_BANDEIRA CASCADE CONSTRAINTS;



CREATE TABLE TB_BANDEIRA (
    ID_BANDEIRA INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    LABEL VARCHAR(20) NOT NULL
);

-- Tabela Role
CREATE TABLE ROLE (
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(50) NOT NULL UNIQUE,
    LABEL VARCHAR(50) NOT NULL
);

-- Tabela Usuario
CREATE TABLE USUARIO (
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USERNAME VARCHAR(50) NOT NULL UNIQUE,
    PASSWORD VARCHAR(100) NOT NULL
);

-- Tabela intermediÃ¡ria users_roles
CREATE TABLE USERS_ROLES (
    USER_ID INT NOT NULL,
    ROLE_ID INT NOT NULL,
    CONSTRAINT FK_USERS_ROLES_USER FOREIGN KEY (USER_ID) REFERENCES USUARIO (ID) ON DELETE CASCADE,
    CONSTRAINT FK_USERS_ROLES_ROLE FOREIGN KEY (ROLE_ID) REFERENCES ROLE (ID) ON DELETE CASCADE,
    PRIMARY KEY (USER_ID, ROLE_ID)
);

-- Tabela Endereco
CREATE TABLE TB_ENDERECO (
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    LOGRADOURO VARCHAR(90) NOT NULL,
    NUMERO VARCHAR(10) NOT NULL,
    COMPLEMENTO VARCHAR(50) NOT NULL,
    CEP CHAR(8) NOT NULL
);

-- Tabela Residencia
CREATE TABLE TB_RESIDENCIA (
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    QNT_MORADORES INT NOT NULL CHECK (QNT_MORADORES >= 0),
    ANDARES INT NOT NULL CHECK (ANDARES >= 1),
    ID_ENDERECO INT NOT NULL,
    CONSTRAINT FK_RESIDENCIA_ENDERECO FOREIGN KEY (ID_ENDERECO) REFERENCES TB_ENDERECO (ID) ON DELETE CASCADE
);

-- Tabela Morador
CREATE TABLE TB_MORADOR (
    ID_MORADOR INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NM_MORADOR VARCHAR(100) NOT NULL,
    CPF_MORADOR CHAR(11) NOT NULL UNIQUE,
    DT_NASCIMENTO DATE NOT NULL,
    ID_RESIDENCIA INT NOT NULL,
    CONSTRAINT FK_MORADOR_RESIDENCIA FOREIGN KEY (ID_RESIDENCIA) REFERENCES TB_RESIDENCIA (ID) ON DELETE CASCADE
);

-- Tabela Fatura
CREATE TABLE TB_FATURA (
    ID_FATURA INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    VALOR_FATURA DECIMAL(10, 2) NOT NULL CHECK (VALOR_FATURA >= 0),
    WATTS DECIMAL(10, 2) NOT NULL CHECK (WATTS >= 0),
    MES_FATURA DATE NOT NULL,
    BANDEIRA_ID INT NOT NULL,
    ID_RESIDENCIA INT NOT NULL,
    CONSTRAINT FK_FATURA_BANDEIRA FOREIGN KEY (BANDEIRA_ID) REFERENCES TB_BANDEIRA (ID_BANDEIRA),
    CONSTRAINT FK_FATURA_RESIDENCIA FOREIGN KEY (ID_RESIDENCIA) REFERENCES TB_RESIDENCIA (ID) ON DELETE CASCADE
);

-- Tabela Post
CREATE TABLE TB_POST (
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DT_POST DATE DEFAULT CURRENT_DATE NOT NULL,
    MSG_POST TEXT NOT NULL,
    ID_USUARIO INT NOT NULL,
    ID_RESIDENCIA INT NOT NULL,
    CONSTRAINT FK_POST_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO (ID) ON DELETE CASCADE,
    CONSTRAINT FK_POST_RESIDENCIA FOREIGN KEY (ID_RESIDENCIA) REFERENCES TB_RESIDENCIA (ID) ON DELETE CASCADE
);
